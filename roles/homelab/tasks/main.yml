# tasks file for homelab
- name: Updates packages
  become: true
  ansible.builtin.apt:
    name: "*"
    state: latest
    update_cache: true
- name: Dependencies
  become: true
  ansible.builtin.apt:
    name: "{{ item }}"
    state: latest
    update_cache: true
  loop:
    - python3-kubernetes
- name: SSH Access Setup
  include_tasks:
    file: access.yml
    apply:
      tags:
        - ssh
  tags:
    - ssh
- name: Before Reboot
  include_tasks:
    file: before.yml
    apply:
      delegate_to: localhost
      tags:
        - before
  tags:
    - before
- name: Reboot the machine
  ansible.builtin.reboot:
    reboot_timeout: 300
    pre_reboot_delay: 30
    test_command: whoami
- name: Wait for machine
  ansible.builtin.wait_for_connection:
    delay: 30
    timeout: 600
- name: Prepare Reboot
  include_tasks:
    file: after.yml
    apply:
      tags:
        - after
  tags:
    - after
